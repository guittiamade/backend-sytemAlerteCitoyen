openapi: 3.0.3
info:
  title: Alerte Citoyen API
  version: 1.0.0
servers:
  - url: http://localhost:8000/api
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Sanctum
  schemas:
    User:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        email: { type: string }
        tel: { type: string, nullable: true }
        profile_id: { type: integer, nullable: true }
        direction_id: { type: integer, nullable: true }
    Direction:
      type: object
      properties:
        id: { type: integer }
        description: { type: string }
        direction_generale: { type: string, nullable: true }
    TypeAlerte:
      type: object
      properties:
        id: { type: integer }
        nom: { type: string }
        description: { type: string, nullable: true }
    Alerte:
      type: object
      properties:
        id: { type: integer }
        titre: { type: string }
        description: { type: string, nullable: true }
        photo: { type: string, nullable: true }
        localisation: { type: string, nullable: true }
        statut: { type: string, enum: [en_attente, en_cours, termine] }
        citoyen_id: { type: integer }
        gestionnaire_id: { type: integer, nullable: true }
        direction_id: { type: integer, nullable: true }
        type_alerte_id: { type: integer }
    Notification:
      type: object
      properties:
        id: { type: integer }
        message: { type: string }
        date_envoi: { type: string, format: date-time, nullable: true }
        statut: { type: boolean }
        utilisateur_id: { type: integer }
        alerte_id: { type: integer, nullable: true }
    PaginationLinks:
      type: object
      properties:
        first: { type: string, nullable: true }
        last: { type: string, nullable: true }
        prev: { type: string, nullable: true }
        next: { type: string, nullable: true }
    PaginationMeta:
      type: object
      properties:
        current_page: { type: integer }
        from: { type: integer, nullable: true }
        last_page: { type: integer }
        path: { type: string }
        per_page: { type: integer }
        to: { type: integer, nullable: true }
        total: { type: integer }
security:
  - bearerAuth: []
paths:
  /health:
    get:
      summary: Health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: ok }

  /auth/register:
    post:
      summary: Register user (citoyen par défaut)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name: { type: string }
                email: { type: string }
                password: { type: string }
                tel: { type: string, nullable: true }
      responses:
        '200': { description: OK }
  /auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        '200': { description: OK }
  /auth/me:
    get:
      summary: Get current user
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
    patch:
      summary: Update current user
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                tel: { type: string }
                email: { type: string }
                password: { type: string }
      responses:
        '200': { description: OK }
  /auth/logout:
    post:
      summary: Logout
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: OK }

  /citoyen/alertes:
    get:
      summary: Lister mes alertes (citoyen)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: statut
          schema: { type: string, enum: [en_attente, en_cours, termine] }
        - in: query
          name: type_alerte_id
          schema: { type: integer }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
        - in: query
          name: per_page
          schema: { type: integer, minimum: 1, maximum: 100 }
        - in: query
          name: page
          schema: { type: integer, minimum: 1 }
      responses:
        '200':
          description: OK
    post:
      summary: Créer une alerte (citoyen)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [titre, type_alerte_id]
              properties:
                titre: { type: string }
                description: { type: string, nullable: true }
                photo: { type: string, nullable: true }
                localisation: { type: string, nullable: true }
                type_alerte_id: { type: integer }
      responses:
        '201': { description: Created }
  /citoyen/alertes/{id}:
    get:
      summary: Détail alerte (citoyen)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }

  /gestionnaire/alertes:
    get:
      summary: Lister alertes (gestionnaire)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: statut
          schema: { type: string, enum: [en_attente, en_cours, termine] }
        - in: query
          name: type_alerte_id
          schema: { type: integer }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
        - in: query
          name: direction_id
          schema: { type: integer }
        - in: query
          name: per_page
          schema: { type: integer, minimum: 1, maximum: 100 }
        - in: query
          name: page
          schema: { type: integer, minimum: 1 }
      responses:
        '200': { description: OK }
  /gestionnaire/alertes/{id}:
    get:
      summary: Détail alerte (gestionnaire)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
    patch:
      summary: Modifier partiellement une alerte (gestionnaire)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                titre: { type: string }
                description: { type: string, nullable: true }
                photo: { type: string, nullable: true }
                localisation: { type: string, nullable: true }
                type_alerte_id: { type: integer }
      responses:
        '200': { description: OK }
  /gestionnaire/alertes/{id}/statut:
    post:
      summary: Changer le statut (gestionnaire)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [statut]
              properties:
                statut: { type: string, enum: [en_attente, en_cours, termine] }
                direction_id: { type: integer, nullable: true }
      responses:
        '200': { description: OK }
  /gestionnaire/alertes/{id}/approuver:
    post:
      summary: Approuver la résolution (gestionnaire)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: OK }

  /direction/alertes:
    get:
      summary: Lister alertes de ma direction
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: statut
          schema: { type: string, enum: [en_attente, en_cours, termine] }
        - in: query
          name: type_alerte_id
          schema: { type: integer }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: date_from
          schema: { type: string, format: date }
        - in: query
          name: date_to
          schema: { type: string, format: date }
        - in: query
          name: per_page
          schema: { type: integer, minimum: 1, maximum: 100 }
        - in: query
          name: page
          schema: { type: integer, minimum: 1 }
      responses:
        '200': { description: OK }
  /direction/alertes/{id}:
    get:
      summary: Détail alerte (direction)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200': { description: OK }
    patch:
      summary: Modifier partiellement une alerte (direction)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: OK }
  /direction/alertes/{id}/statut:
    post:
      summary: Changer le statut (direction)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [statut]
              properties:
                statut: { type: string, enum: [en_attente, en_cours, termine] }
      responses:
        '200': { description: OK }

  /directions:
    get:
      summary: Lister directions (auth)
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Direction' }

  /admin/directions:
    get:
      summary: Lister directions (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: OK }
    post:
      summary: Créer une direction (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [description]
              properties:
                description: { type: string }
                direction_generale: { type: string, nullable: true }
      responses:
        '201': { description: Created }
  /admin/directions/{id}:
    put:
      summary: Mettre à jour une direction (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                description: { type: string }
                direction_generale: { type: string, nullable: true }
      responses:
        '200': { description: OK }
    delete:
      summary: Supprimer une direction (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '204': { description: No Content }

  /admin/types-alertes:
    get:
      summary: Lister types d’alertes (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '200': { description: OK }
    post:
      summary: Créer type d’alerte (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [nom]
              properties:
                nom: { type: string }
                description: { type: string, nullable: true }
      responses:
        '201': { description: Created }
  /admin/types-alertes/{id}:
    put:
      summary: Mettre à jour type d’alerte (admin)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nom: { type: string }
                description: { type: string, nullable: true }
      responses:
        '200': { description: OK }
    delete:
      summary: Supprimer type d’alerte (admin)
      security: [{ bearerAuth: [] }]
      responses:
        '204': { description: No Content }

  /notifications:
    get:
      summary: Lister mes notifications
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: statut
          schema: { type: integer, enum: [0,1] }
        - in: query
          name: per_page
          schema: { type: integer, minimum: 1, maximum: 100 }
        - in: query
          name: page
          schema: { type: integer, minimum: 1 }
      responses:
        '200': { description: OK }
  /notifications/{id}:
    patch:
      summary: Marquer une notification comme lue
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                statut: { type: boolean }
      responses:
        '200': { description: OK }
